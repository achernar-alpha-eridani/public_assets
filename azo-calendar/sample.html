<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <style>
    table {
      width: 100%;
      height: 100%;
      table-layout: fixed;
    }

    th,
    td {
      text-align: center;
      vertical-align: middle;
    }

    td {
      cursor: pointer;
    }

    tbody td:hover {
      background-color: #f2f2f2;
    }

    #events {
      background-image: url("https://raw.githubusercontent.com/achernar-alpha-eridani/public_assets/main/azo-calendar/events_background.jpg");
      background-size: cover;
    }

    #calendar {
      background-color: #f0eee5;
    }

    .draw-sprite {
      --n: 1;
      /* scaling factor */
      /* coordinates of the image */
      --i: 0;

      background-image: url("https://raw.githubusercontent.com/achernar-alpha-eridani/public_assets/main/azo-calendar/sprite.png");
      height: calc(280px / var(--n));
      width: calc(330px / var(--n));
      background-position: calc(var(--i)/var(--n) * -330px) 20px;
      background-size: calc(2000px / var(--n)) calc(280px / var(--n));
      background-repeat: no-repeat;
    }

    .marker-1 {
      background-image: url("https://raw.githubusercontent.com/achernar-alpha-eridani/public_assets/main/azo-calendar//marks/1.svg");
      background-size: auto auto;
      background-repeat: no-repeat;
    }
  </style>
</head>

<body>
  <div class="container mt-3">
    <div class="row">
      <div id="events" class="col-6 themed-grid-col">
        <h3 class="ms-3 mt-3 mb-3">Save the dates</h3>
        <div class="row ms-3">
          No events for this month...
        </div>
        <div class="d-block ms-3">
          <img
            src="https://raw.githubusercontent.com/achernar-alpha-eridani/public_assets/main/azo-calendar/AZO_logo.png"
            width="120px" height="120px"></img>
        </div>
        <div class="row ms-3">
          Activities organized and/or supported by Active Zone Outdoor
        </div>
        <div class="row ms-3">
          <br /><br /><br /><br /><br />
          <br /><br /><br /><br /><br />
        </div>
      </div>
      <div id="calendar" class="col-6 themed-grid-col">
        <h2 class="text-center mt-3 mb-3"><span id="title-month">{month}</span> <span id="title-year">{year}</span></h2>

        <div class="btn-group" role="group" aria-label="Button group with nested dropdown">
          <button type="button" class="btn btn-outline-primary btn-sm">&laquo; Previous</button>

          <div class="btn-group">
            <button type="button" class="btn btn-outline-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown"
              aria-expanded="false">
              2023
            </button>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="?year=2020">2020</a></li>
              <li><a class="dropdown-item" href="?year=2021">2021</a></li>
              <li><a class="dropdown-item" href="?year=2022">2022</a></li>
              <li>
                <hr class="dropdown-divider">
              </li>
              <li><a class="dropdown-item" href="?year=2024">2024</a></li>
              <li><a class="dropdown-item" href="?year=2025">2025</a></li>
            </ul>
          </div>

          <div class="btn-group">
            <button type="button" class="btn btn-outline-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown"
              aria-expanded="false">
              April
            </button>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="">January</a></li>
              <li><a class="dropdown-item" href="">February</a></li>
              <li><a class="dropdown-item" href="">March</a></li>
              <li>
                <hr class="dropdown-divider">
              </li>
              <li><a class="dropdown-item" href="">May</a></li>
              <li><a class="dropdown-item" href="">June</a></li>
              <li><a class="dropdown-item" href="">July</a></li>
              <li><a class="dropdown-item" href="">August</a></li>
              <li><a class="dropdown-item" href="">September</a></li>
              <li><a class="dropdown-item" href="">October</a></li>
              <li><a class="dropdown-item" href="">November</a></li>
              <li><a class="dropdown-item" href="">December</a></li>
            </ul>
          </div>

          <button type="button" class="btn btn-outline-primary btn-sm">Next &raquo;</button>
        </div>
      </div>

      <table class="table">
        <thead>
          <tr>
            <th scope="col">Mon</th>
            <th scope="col">Tue</th>
            <th scope="col">Wed</th>
            <th scope="col">Thu</th>
            <th scope="col">Fri</th>
            <th scope="col">Sat</th>
            <th scope="col">Sun</th>
          </tr>
        </thead>
        <tbody id="calendar-body" class="table-group-divider">
          <tr>
            <td class="draw-sprite" style="--n:4;--i:0">3</td>
            <td>4</td>
            <td class="draw-sprite" style="--n:4;--i:1">5</td>
            <td>6</td>
            <td>7</td>
            <td>8</td>
            <td class="draw-sprite" style="--n:4;--i:2">9</td>
          </tr>
          <tr>
            <td>10</td>
            <td class="marker-1" style="--n:4;--i:3">11</td>
            <td>12</td>
            <td class="draw-sprite" style="--n:4;--i:4">13</td>
            <td class="draw-sprite" style="--n:4;--i:5">14</td>
            <td>15</td>
            <td>16</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="row row-cols-auto ms-3 ps-0">
    <div class="btn-group" role="group" aria-label="Button group with nested dropdown">
      <button type="button" class="btn btn-outline-primary btn-sm">&laquo; Previous</button>

      <div class="btn-group">
        <button type="button" class="btn btn-outline-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown"
          aria-expanded="false">
          2023
        </button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="?year=2020">2020</a></li>
          <li><a class="dropdown-item" href="?year=2021">2021</a></li>
          <li><a class="dropdown-item" href="?year=2022">2022</a></li>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li><a class="dropdown-item" href="?year=2024">2024</a></li>
          <li><a class="dropdown-item" href="?year=2025">2025</a></li>
        </ul>
      </div>

      <div class="btn-group">
        <button type="button" class="btn btn-outline-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown"
          aria-expanded="false">
          April
        </button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="">January</a></li>
          <li><a class="dropdown-item" href="">February</a></li>
          <li><a class="dropdown-item" href="">March</a></li>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li><a class="dropdown-item" href="">May</a></li>
          <li><a class="dropdown-item" href="">June</a></li>
          <li><a class="dropdown-item" href="">July</a></li>
          <li><a class="dropdown-item" href="">August</a></li>
          <li><a class="dropdown-item" href="">September</a></li>
          <li><a class="dropdown-item" href="">October</a></li>
          <li><a class="dropdown-item" href="">November</a></li>
          <li><a class="dropdown-item" href="">December</a></li>
        </ul>
      </div>

      <button type="button" class="btn btn-outline-primary btn-sm">Next &raquo;</button>
    </div>
  </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"></script>
  <script>
    const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

    function checkParameter(value, start, end, current) {
      let result = value;

      if (isFinite(result) && result >= start && result <= end) {
        console.log(`valid value [${result}]`);
      } else {
        result = parseInt(current);
        console.log(`invalid value ... set to current [${current}]`);
      }

      return result;
    }

    function buildCalendar(year, month) {
      // get the container and table body elements
      const container = document.querySelector('#calendar-body');

      // get the first day of the month and the number of days in the month
      const firstDayOfMonth = new Date(year, month, 1);
      const lastDayOfMonth = new Date(year, month + 1, 0);

      // initialize the date counter and row element
      let date = 1;
      let row = document.createElement('tr');

      // loop through each day of the month
      for (let i = 0; i < lastDayOfMonth.getDate(); i++) {
        // if it's a new week, create a new row element
        if (i > 0 && (i + firstDayOfMonth.getDay() - 1) % 7 === 0) {
          container.appendChild(row);
          row = document.createElement('tr');
        }

        // create a new cell element for the date
        const cell = document.createElement('td');

        // if it's not the first week of the month and this is the first day of the current row, add empty cells to fill it out
        if (i === 0 && firstDayOfMonth.getDay() !== 0) {
          for (let j = 0; j < firstDayOfMonth.getDay() - 1; j++) {
            row.appendChild(document.createElement('td'));
          }
        }

        // add the date to the cell element, and increment the counter
        cell.textContent = date;
        date++;

        // add a click listener to the cell element to toggle its selected state
        //cell.addEventListener('click', () => {
        //  cell.classList.toggle('selected');
        //});

        // add the cell to the current row element
        row.appendChild(cell);
      }

      // if any empty cells are needed at the end of the month to fill out the last row, add them now
      while (row.children.length < 7) {
        row.appendChild(document.createElement('td'));
      }

      // add the last row to the table body
      container.appendChild(row);

      // get the months and year containers
      const titleYear = document.querySelector('#title-year');
      const titleMonth = document.querySelector('#title-month');
      titleYear.innerHTML = year;
      titleMonth.innerHTML = monthNames[firstDayOfMonth.getMonth()];
    }

    google.script.url.getLocation(function (location) {
      const today = new Date();
      let year = checkParameter(parseInt(location.parameter['year']), 2020, 2100, today.getFullYear());
      let month = checkParameter(parseInt(location.parameter['month']), 1, 12, today.getMonth() + 1);

      console.log(year, month);
      buildCalendar(year, month - 1);
    });


    window.addEventListener('load', function () {
      console.log('Page is loaded');
    });

  </script>
</body>

</html>